/*! Suggester - A Better Autocomplete Widget - v1.4.0 - Aug 2014
* https://github.com/kensnyder/jQuery-Suggester
* Copyright (c) 2014 Ken Snyder; Licensed MIT */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){"use strict";function b(b){var c=document.createElement(b);return a(c)}function c(a){for(var b=[],c=0,d=a.length;d>c;c++)-1==b.indexOf(a[c])&&b.push(a[c]);return b}function d(a){if(a.createTextRange){var b=document.selection.createRange().duplicate();return b.moveEnd("character",a.value.length),""===b.text?a.value.length:a.value.lastIndexOf(b.text)}return a.selectionStart}function e(a){if(a.createTextRange){var b=document.selection.createRange().duplicate();return b.moveStart("character",-a.value.length),b.text.length}return a.selectionEnd}function f(b,c){a.fn[b]=function(b){var d=this.data("SuggesterInstance");if("string"==typeof b&&d instanceof a.Suggester&&"function"==typeof d[b]){var e=Array.prototype.slice.call(arguments,1);return d[b].apply(d,e)}return d?this:this.each(function(){var d=a(this),e=new c(d,b);d.data("SuggesterInstance",e)})}}a.fn.suggSetValue=function(a){return this.length>0&&(this[0].value=a),this},a.fn.suggGetValue=function(){return 0===this.length?void 0:this[0].value},a.fn.suggAppendChild=function(a){return this.length>0&&a.length>0&&this[0].appendChild(a[0]),this},a.fn.suggInsertAfter=function(a){return this.length>0&&a.length>0&&(this[0].nextSibling?a[0].parentNode.insertBefore(a[0],this[0].nextSibling):a[0].parentNode.appendChild(this[0])),this},a.fn.suggInsertBefore=function(a){return this.length>0&&a.length>0&&a[0].parentNode.insertBefore(this[0],a[0]),this},a.fn.suggGetAttr=function(a){return this.length>0?this[0].getAttribute(a):void 0},a.fn.suggSetAttr=function(a,b){return this.length>0&&this[0].setAttribute(a,b),this};var g,h=a(document);a.Suggester=function(){arguments[0]!==a.Suggester.doSubclass&&this.initialize.apply(this,Array.prototype.slice.call(arguments))},a.Suggester.defaultOptions={data:!1,valueProperty:"value",labelProperty:"value",searchProperties:["value"],matchAt:"anywhere",caseSensitive:!1,dataUrl:!1,dataType:"json",fly:"down",suggListPosition:"relative",multiselect:!0,preventDuplicates:!0,omitAlreadyChosenItems:!0,minChars:3,keyDelay:400,addOnComma:!0,addOnTab:!0,addOnSemicolon:!1,addOnSubmit:!0,addOnBlur:!1,submitOnEnter:!1,inputSize:"auto",placeholder:"",emptyText:"(Type a comma to create a new item)",prompt:!1,maxSuggestions:10,saveToInput:!0,addHiddenInputs:!0,hiddenName:null,hightlightSubstring:!0,template:'<div class="sugg-widget"><ul class="sugg-box"><li class="sugg-box-item sugg-tag"><span class="sugg-label">TAG TEXT GOES HERE</span><span class="sugg-remove" title="Click to remove">&times;</span></li><li class="sugg-box-item sugg-input-wrapper"><input type="text" class="sugg-input" value="" autocomplete="off" /></li></ul><div class="sugg-list-wrapper"><ul class="sugg-list" style="display:none"><li class="sugg-item {record.cssClass}">{record.value}</li><li class="sugg-empty"></li><li class="sugg-prompt"></li></ul></div></div>',listItemTemplate:null,theme:"coolblue"},a.Suggester.prototype={initialize:function(b,c){return this.$originalInput=a(b),this.$form=a(this.$originalInput.prop("form")),this.$originalInput.data("SuggesterInstance")?this:(a.Suggester.instances.push(this),0===this.$originalInput.length?(window.console&&window.console.warn&&window.console.warn("Suggester: text input not found. Passed value=",b),this):(this._processOptions(c),this.setData(this.options.data||[]),this.tags=[],this.hiddenName=this.options.hiddenName||this.$originalInput.suggGetAttr("name")+"_tags[]",this.$focusedTag=!1,this.$currentItem=!1,this._setupPubsub(),this._render(),this._setupListeners(),this.publish("Initialize"),this))},destroy:function(b){b=b||{},this.$originalInput.suggInsertBefore(this.$widget).show(),this.$originalInput.removeData("SuggesterInstance"),b.keepHiddenInputs&&this.$widget.find("input[type=hidden]").suggInsertBefore(this.$widget),this.tags=[],this.data=[],this.$widget.empty().remove();for(var c=this,d=0,e=a.Suggester.instances.length;e>d;d++)if(c===a.Suggester.instances[d])return a.Suggester.instances.splice(d,1),!1;return this.$originalInput},add:function(a,b,c){var d,e,f,g=null===a||void 0===a||a===!1,h=null===b||void 0===b||b===!1;if(1==arguments.length?f=this.searchData(a,this.options.valueProperty===this.options.labelProperty?[this.options.valueProperty]:[this.options.valueProperty,this.options.labelProperty]):2!=arguments.length||g||h?2==arguments.length&&g&&!h?f=this.searchData(b,[this.options.labelProperty]):2==arguments.length&&!g&&h?f=this.searchData(a,[this.options.valueProperty]):c&&(f=c.data("tag-record")):(f=this.searchData(a,[this.options.valueProperty]),f&&f[this.options.labelProperty]==b||(f=void 0)),f&&(a=f[this.options.valueProperty],b=f[this.options.labelProperty]),"string"!=typeof b&&"number"!=typeof b&&(b=a),"string"!=typeof a&&"number"!=typeof a&&(a=b),d=this.publish("BeforeAdd",{value:a,label:b,item:c,record:f}),d.isDefaultPrevented())return void 0;this.options.preventDuplicates&&(e=this.getTagIndex(a),e>-1&&this._spliceTagByIdx(e));var i=this.pushTag(d.value,d.label);return this.options.saveToInput&&this.save(),this.hidePlaceholder(),this.publish("AfterAdd",{tag:i,item:d.item,record:d.record}),this.publish("Change"),i.getElement()},pushTag:function(c,d){var e,f,g;return this.options.addHiddenInputs&&(e=b("input").suggSetAttr("type","hidden").suggSetAttr("name",this.hiddenName).suggSetValue(c),this.$widget.suggAppendChild(e)),f=this.$tagTemplate.clone().data("tag-value",c).data("tag-label",d),g=new a.Suggester.Tag({suggester:this,index:this.tags.length,$tag:f,$hidden:e,value:c,label:d}),this.tags.push(g),this.options.multiselect?(f.find(".sugg-label").text(d),f.suggInsertBefore(this.$inputWrapper)):this.$input.suggSetValue(c),g},addCurrentBuffer:function(){var b=a.trim(this.$input.suggGetValue());return b!==this.options.placeholder&&""!==b&&(this.add(b),this.$input.suggSetValue("")),this},moveSelection:function(a){var b,c=this.$suggList.find(".sugg-item");b=this.$currentItem&&this.$currentItem.length?"down"==a?this.$currentItem.next():this.$currentItem.prev():"down"==a?c.first():c.last();var d=this.publish("BeforeMove",{direction:a,current:this.$currentItem,next:b,cancelable:!0});return d.isDefaultPrevented()?this:(d.current&&d.current.length&&this.deselectItem(d.current),d.next&&d.next.length&&this.selectItem(d.next),this.$currentItem=d.next,this.publish("AfterMove",{direction:a,last:d.current,current:this.$currentItem}),this)},selectItem:function(a){return a.addClass("sugg-selected"),this},deselectItem:function(a){return a.removeClass("sugg-selected"),this},deselectAllItems:function(){return this.$suggList.find(".sugg-item").removeClass("sugg-selected"),this.$currentItem=null,this},suggest:function(a){this._text=a,this.options.dataUrl?this.fetchResults(a):this.handleSuggestions(this.getResults(a))},addData:function(a){var b,c,d;if(a.length>0&&"object"!=typeof a[0])for(b=0,c=a.length;c>b;b++)d={},d[this.options.valueProperty]=""+a[b],this.data.push(d);else this.data=this.data.concat(a);return this},setData:function(a){return this.data=[],this.addData(a),this},getData:function(){return this.data},setFlyDirection:function(a){return"up"==a?(this.$suggListWrapper.suggInsertBefore(this.$box),this.$widget.removeClass("sugg-fly-down").addClass("sugg-fly-up")):"down"==a&&(this.$suggListWrapper.suggInsertAfter(this.$box),this.$widget.addClass("sugg-fly-down").removeClass("sugg-fly-up")),this},focusTag:function(a){return this.unfocusTag(),this.$focusedTag=a.addClass("sugg-focused"),h.keydown(this.removeFocusedTag).click(this.unfocusTag),this},unfocusTag:function(){return h.off("keydown",this.removeFocusedTag).off("click",this.unfocusTag),this.$focusedTag&&this.$focusedTag.removeClass("sugg-focused"),this.$focusedTag=null,this},removeFocusedTag:function(a){return a&&a.which&&(8==a.which||46==a.which)&&(this.$focusedTag&&this.remove(this.$focusedTag),a.preventDefault()),this.unfocusTag(),this},remove:function(b){var c,d,e,f;if("number"==typeof b.nodeType&&"object"==typeof b.style&&(b=a(b)),b instanceof a)d=b.data("tag-value");else{d=b,b=!1;for(var g=0,h=this.tags.length;h>g;g++)if(d==this.tags[g].getValue()||d==this.tags[g].getLabel()){b=this.tags[g].getElement();break}if(!b)return this}return e=b.data("tag-label"),c=this.publish("BeforeRemove",{tag:b,value:d,label:e,cancelable:!0}),c.isDefaultPrevented()?this:(f=this._spliceTag(c.value),this.options.saveToInput&&this.save(),this.publish("AfterRemove",{tag:b,value:c.value,label:e,removed:f}),this.publish("Change"),this)},findRecord:function(a){return this.searchData(a,this.options.searchProperties)},searchData:function(a,b){var c,d,e,f,g,h=this.getData();if(d=h.length,f=b?b.length:0,0===d||0===f)return!1;if(a=""+a,1==f){if(g=b[0],this.options.caseSensitive){for(c=0;d>c;c++)if(h[c][g]===a)return h[c]}else for(a=a.toLowerCase(),c=0;d>c;c++)if("string"==typeof h[c][g]&&h[c][g].toLowerCase()===a)return h[c]}else if(this.options.caseSensitive){for(c=0;d>c;c++)for(e=0;f>e;e++)if(h[c][b[e]]===a)return h[c]}else for(a=a.toLowerCase(),c=0;d>c;c++)for(e=0;f>e;e++)if("string"==typeof h[c][b[e]]&&h[c][b[e]].toLowerCase()===a)return h[c];return!1},suggestIfNeeded:function(){var a=this.$input.suggGetValue();return a.length>=this.options.minChars?this.suggest(a):this.options.prompt?this.showPrompt():this.closeSuggestBox(),this},showPrompt:function(){return this.$prompt?(this.$suggList.html("").suggAppendChild(this.$prompt),this.openSuggestBox(),this.$widget.addClass("sugg-prompt-shown"),this):this},showEmptyText:function(){return this.$suggList.html(""),this.options.emptyText?(this.$empty.html(this.options.emptyText).appendTo(this.$suggList),this.openSuggestBox(),this.$widget.addClass("sugg-empty-shown")):this.closeSuggestBox(),this},fetchResults:function(b){this._searchTerm=b;var c={context:this,url:this.options.dataUrl.replace("%s",b)};if("json"==this.options.dataType.toLowerCase())c.dataType="json";else{if("jsonp"!=this.options.dataType.toLowerCase())throw new Error('jQuery.Suggester#fetchResults: options.dataType must be "json" or "jsonp".');c.dataType="jsonp",c.url=c.url.replace("%s","?")}var d=this.publish("BeforeAjax",{settings:c,term:b,cancelable:!0});if(d.isDefaultPrevented())return this._afterFetch(d.records||[]),!1;d.settings.beforeSend=this._beforeFetch;var e=a.ajax(d.settings).done(this._afterFetch);return this.publish("AfterAjax",{settings:d.settings,term:d.term,jqXHR:e}),e},abortFetch:function(){return this._jqXHR&&this._jqXHR.abort(),this},handleSuggestions:function(b){if(!b||0===b.length)return this.showEmptyText(),this;var c;this.$suggList.empty();for(var d=0,e=b.length;e>d;d++)c=a(this._formatSuggestion(b[d],this._text)),c.data("tag-record",b[d]),this.$suggList.suggAppendChild(c);var f=this.publish("BeforeSuggest",{text:this._text,cancelable:!0});return f.isDefaultPrevented()?this:(this.openSuggestBox(),this.publish("AfterSuggest"),this)},isSuggestBoxOpen:function(){return"none"!=this.$suggList.css("display")},openSuggestBox:function(){var b,c,d,e,f,i,j=this;return"absolute"==this.options.suggListPosition&&(c=(g||(g=a(document.body))).offset(),e=this.$box.position(),"up"==this.options.fly?(this.$suggList.css("visibility","hidden").show(),f=e.top-c.top-this.$box.outerHeight()+this.$box.height()-this.$suggList.outerHeight(),this.$suggList.hide().css("visibility","visible")):f=e.top-c.top+this.$box.outerHeight(),i=e.left-c.left,d=this.$box.outerWidth(),this.$suggList.css({top:f+"px",left:i+"px",width:d})),b=this.publish("BeforeOpen",{cancelable:!0}),b.isDefaultPrevented()?this:(this.$widget.addClass("sugg-list-open").removeClass("sugg-prompt-shown").removeClass("sugg-empty-shown"),setTimeout(function(){h.on("click",j._closeOnOutsideClick)},0),this.$suggList.show(),this.publish("AfterOpen"),this)},closeSuggestBox:function(){h.off("click",this._closeOnOutsideClick);var a=this.publish("BeforeClose",{cancelable:!0});return a.isDefaultPrevented()||(this.$suggList.hide(),this.$widget.removeClass("sugg-list-open")),this.publish("AfterClose"),this},focus:function(){return 0===this.tags.length&&this.options.placeholder&&this.hidePlaceholder(),this.$input[0].focus(),this},blur:function(){return this.$input[0].blur(),0===this.tags.length&&this.options.placeholder&&this.showPlaceholder(),this.closeSuggestBox(),this},isFocused:function(){return this.$input.is(":focus")},getResults:function(a){var b,c,d,e,f,g,h,i,j,k,l;if(a=""+a,c=this.publish("BeforeFilter",{text:a}),c.results)e=c.results;else for(this.options.caseSensitive||(d=c.text.toLowerCase()),b=this,e=[],f=this.getData(),g=b.options.searchProperties,l=g.length,i=0,j=f.length;j>i;i++)if(!(b.options.omitAlreadyChosenItems&&b.getTagIndex(f[i][b.options.valueProperty])>-1)){for(k=0;l>k;k++)if(h=""+(f[i][g[k]]||""),b.options.caseSensitive||(h=h.toLowerCase()),"anywhere"==b.options.matchAt&&h.indexOf(d)>-1||h.indexOf(d)==b.options.matchAt||"end"==b.options.matchAt&&h.indexOf(d)==h.length-d-length){e.push(f[i]);break}if(b.options.maxSuggestions>0&&e.length>=b.options.maxSuggestions)break}return c=this.publish("AfterFilter",{text:c.text,results:e}),c.results},clear:function(){return this.setValue(null),this},getTags:function(){return Array.prototype.slice.call(this.tags)},eachTag:function(b){return a.each(this.getTags(),b),this},serialize:function(){for(var a=[],b=0,c=this.tags.length;c>b;b++)a.push(encodeURIComponent(this.tags[b].getHidden().name)+"="+encodeURIComponent(this.tags[b].getHidden().value));return a.join("&")},getValues:function(){for(var a=[],b=0,c=this.tags.length;c>b;b++)a.push(this.tags[b].getValue());return a},getValue:function(){return this.getValues().join(",")},setValue:function(b){var d,e,f,g,h,i;for(d=0,e=this.tags.length;e>d;d++)this.tags[d].getHidden().remove(),this.tags[d].$tag.remove();if(this.tags=[],"string"==typeof b||"number"==typeof b)for(b=String(b).replace(/\\,/g,"").split(/,/g),d=0,e=b.length;e>d;d++)b[d]=b[d].replace(/\u0001/g,",");if(!a.isArray(b)||0===b.length)return this._handleEmptyValue();for(g=[],d=0,e=b.length;e>d;d++)f=a.trim(b[d]),""!==f&&g.push(f);if(0===g.length)return this._handleEmptyValue();for(g=c(g),d=0,e=g.length;e>d;d++)this.data.length>0&&(i=this.searchData(g[d],[this.options.labelProperty]))?(f=i[this.options.valueProperty],h=i[this.options.labelProperty],this.pushTag(f,h)):this.pushTag(g[d],g[d]);return this.options.saveToInput&&this.save(),this.publish("Change"),this},_handleEmptyValue:function(){return this.showPlaceholder(),this.options.saveToInput&&this.save(),this.publish("Change"),this},setTheme:function(a){return this._theme&&this.$widget.removeClass("sugg-theme-"+this._theme),this._theme=a,this.$widget.addClass("sugg-theme-"+this._theme),this},showPlaceholder:function(a){return a="string"==typeof a?a:this.options.placeholder||"",a.length&&(this.$widget.addClass("sugg-placeholder-on"),this.$input.suggSetValue(a),this._updateInputSize()),this},hidePlaceholder:function(){return this.$widget.removeClass("sugg-placeholder-on"),this.$input.suggSetValue(""),this._updateInputSize(),this},publish:function(b,c){var d=a.Event(b);return d.target=this,c&&a.extend(d,c),this.trigger(d),d},getInstance:function(){return this},_processOptions:function(b){this.options=a.extend({},a.Suggester.defaultOptions,b),("start"==this.options.matchAt||"beginning"==this.options.matchAt)&&(this.options.matchAt=0)},_render:function(){this.$widget=a(this.options.template),this.publish("BeforeRender",{widget:this.$widget}),this.$box=this.$widget.find(".sugg-box"),this.$tagTemplate=this.$box.find(".sugg-tag").remove(),this.$input=this.$box.find(".sugg-input"),this.$inputWrapper=this.$box.find(".sugg-input-wrapper"),this.$suggListWrapper=this.$widget.find(".sugg-list-wrapper"),this.$suggList=this.$widget.find(".sugg-list"),"absolute"==this.options.suggListPosition&&(this.$suggList.appendTo(document.body),document.body.style.position="relative",this.$suggList.css("position","absolute")),this.$empty=this.$suggList.find(".sugg-empty").html(this.options.emptyText).remove(),this.$prompt=this.$suggList.find(".sugg-prompt").html(this.options.prompt||"").remove(),this.listItemTemplate=this.options.listItemTemplate||this.$suggList.html(),this.$suggList.html(""),this.setFlyDirection(this.options.fly),this.$widget.suggInsertBefore(this.$originalInput.hide()),this._handleStartValue(),0===this.options.minChars&&(this.options.inputSize="",this.$input.width(this.$box.width()-parseFloat(this.$inputWrapper.css("paddingLeft"))-parseFloat(this.$inputWrapper.css("paddingRight"))-parseFloat(this.$inputWrapper.css("marginLeft"))-parseFloat(this.$inputWrapper.css("marginRight"))-parseFloat(this.$inputWrapper.css("borderLeftWidth"))-parseFloat(this.$inputWrapper.css("borderRightWidth"))-parseFloat(this.$input.css("paddingLeft"))-parseFloat(this.$input.css("paddingRight"))-parseFloat(this.$input.css("marginLeft"))-parseFloat(this.$input.css("marginRight"))-parseFloat(this.$input.css("borderLeftWidth"))-parseFloat(this.$input.css("borderRightWidth")))),this.options.theme&&this.setTheme(this.options.theme),this.publish("AfterRender",{widget:this.$widget})},_handleStartValue:function(){var a=this.$originalInput.suggGetValue();a&&(this.hidePlaceholder(),this.setValue(a)),0===this.tags.length?this.showPlaceholder():this.hidePlaceholder()},_setupListeners:function(){this.unfocusTag=a.proxy(this,"unfocusTag"),this.removeFocusedTag=a.proxy(this,"removeFocusedTag"),this.suggestIfNeeded=a.proxy(this,"suggestIfNeeded"),this._closeOnOutsideClick=a.proxy(this,"_closeOnOutsideClick"),this.$input.focus(a.proxy(this,"_onInputFocus")),this.$input.blur(a.proxy(this,"_onInputBlur")),this.$box.delegate(".sugg-remove","click",a.proxy(this,"_onTagRemoveClick")),this.$box.delegate(".sugg-tag","click",a.proxy(this,"_onTagClick")),this.$suggList.mouseover(a.proxy(this,"_onListMouseover")),this.$suggList.click(a.proxy(this,"_onListClick")),this.$box.click(a.proxy(this,"_onBoxClick")),a.Suggester.quickBind(this.$input.get(0),"keydown",a.proxy(this,"_onKeydown")),this.$input.on("cut delete",a.proxy(this,"_onCutDelete")),this.$input.on("paste",a.proxy(this,"_onPaste")),this.$form.submit(a.proxy(this,"_onSubmit"))},_onInputFocus:function(a){this.$widget.addClass("sugg-active"),this.hidePlaceholder();var b,c,d=this.$input.suggGetValue();this.unfocusTag(),0===this.options.minChars?(c=this.data||[],this.options.maxSuggestions>0&&(c=c.slice(0,this.options.maxSuggestions)),b=this.publish("DefaultSuggestions",{suggestions:c}),!b.isDefaultPrevented()&&b.suggestions&&this.handleSuggestions(b.suggestions)):d===this.options.placeholder?this._updateInputSize():""===d&!!this.options.prompt&&this.showPrompt(),this.publish("AfterFocus",{event:a})},_onInputBlur:function(b){var c=a.trim(this.$input.suggGetValue()),d=this.publish("BeforeBlur",{event:b,value:c,cancelable:!0});if(d.isDefaultPrevented())return void b.preventDefault();var e=this;this.options.placeholder&&""===d.value?(0===this.tags.length&&this.showPlaceholder(),e.publish("AfterBlur",{event:b,value:d.value,newTag:void 0})):""!==d.value&&this.options.addOnBlur&&(this._onInputBlurTimeout=setTimeout(function(){var a=e.add(d.value);e.$input.suggSetValue(""),e.publish("AfterBlur",{event:b,value:d.value,newTag:a})},500)),this.$widget.removeClass("sugg-active")},_onTagRemoveClick:function(b){this.unfocusTag(),b.preventDefault(),b.stopImmediatePropagation();var c=a(b.target).parents(".sugg-tag");this.remove(c)},_onTagClick:function(b){var c=a(b.target);c.hasClass("sugg-tag")||(c=c.parents(".sugg-tag")),b.stopImmediatePropagation(),this.focusTag(c)},_onListMouseover:function(b){var c=a(b.target);c.hasClass("sugg-list")||(c.hasClass("sugg-item")||(c=c.parents(".sugg-item")),c.hasClass("sugg-item")&&(this.deselectAllItems(),this.selectItem(c),this.$currentItem=c))},_onListClick:function(b){clearTimeout(this._onInputBlurTimeout);var c=a(b.target);if(!c.hasClass("sugg-list")&&(c.hasClass("sugg-item")||(c=c.parents(".sugg-item")),c.hasClass("sugg-item"))){var d=c.data("tag-record");this.add(d[this.options.valueProperty],d[this.options.labelProperty],c),this.closeSuggestBox(),this.options.multiselect&&(this.$input.suggSetValue(""),this._updateInputSize(),this.focus())}},_onBoxClick:function(a){a.target==this.$box[0]&&(this.unfocusTag(),this.focus())},_onKeydown:function(a){var b=this.publish("BeforeHandleKey",{keydown:a,cancelable:!0});if(!b.isDefaultPrevented()){var c=a.metaKey||a.shiftKey||a.altKey;c?this._key_other(a):38==a.which?this._key_UP(a):40==a.which?this._key_DOWN(a):8==a.which?this._key_BACKSPACE(a):this.options.addOnTab&&9==a.which||this.options.addOnComma&&188==a.which||this.options.addOnSemicolon&&59==a.which?this._key_TAB_COMMA(a):27==a.which?this._key_ESC(a):13==a.which?this._key_ENTER(a):this._key_other(a),this._updateInputSize(),this.publish("AfterHandleKey",{keydown:a})}},_onCutDelete:function(){setTimeout(a.proxy(this._updateInputSize,this),0)},_onPaste:function(b){var c,d,e,f,g=[],h=[];try{c=b.originalEvent.clipboardData.getData("text/plain")}catch(i){c=window.clipboardData.getData("Text")}if(b.preventDefault(),this.options.addOnTab&&(g=c.split("	")),g.length<2&&this.options.addOnSemicolon&&(g=c.split(";")),g.length<2&&this.options.addOnComma&&(g=c.split(",")),g.length>0)for(e=0,f=g.length;f>e;e++)d=a.trim(g[e]),""!==d&&h.push(d);var j=this.publish("BeforePaste",{event:b,value:c,tags:h});if(!j.isDefaultPrevented()){if(j.tags.length<2)return this.$input.suggSetValue(this.$input.suggGetValue()+c),void this._updateInputSize();for(b.preventDefault(),e=0,f=j.tags.length;f>e;e++)this.add(h[e]);this.publish("AfterPaste",{event:b,value:c,tags:j.tags})}},_key_UP:function(a){a.preventDefault(),this.unfocusTag(),this.moveSelection("up")},_key_DOWN:function(a){a.preventDefault(),this.unfocusTag(),this.isSuggestBoxOpen()&&this.moveSelection("down")},_key_BACKSPACE:function(a){var b;this.$currentItem=null,this._isCursorAtStart()?(this.options.multiselect&&this.tags.length>0&&(a.preventDefault(),b=this.tags[this.tags.length-1].$tag,this.$focusedTag&&b&&this.$focusedTag[0]==b[0]?this.remove(b):b&&(this.$focusedTag=b,b.addClass("sugg-focused"))),this.closeSuggestBox()):this._key_other(a)},_key_TAB_COMMA:function(a){(9!=a.which||""!==this.$input.suggGetValue())&&(a.preventDefault(),""!==this.$input.suggGetValue()&&(this.$currentItem=null,this.add(this.$input.suggGetValue()),this.options.multiselect&&this.$input.suggSetValue(""),this.closeSuggestBox()))},_key_ESC:function(){this.closeSuggestBox()},_key_ENTER:function(a){if(this.$currentItem){var b=this.$currentItem.data("tag-record");this.add(b[this.options.valueProperty],b[this.options.labelProperty],this.$currentItem),this.options.multiselect&&this.$input.suggSetValue(""),this.closeSuggestBox(),this.$currentItem=null}this.options.submitOnEnter||a.preventDefault()},_key_other:function(){this.abortFetch(),clearTimeout(this.timeoutHandle),this.$currentItem=null,this.unfocusTag(),this.timeoutHandle=setTimeout(this.suggestIfNeeded,this.options.keyDelay||0)},_onSubmit:function(a){var b=this.publish("BeforeSubmit",{event:a,form:this.$form,cancelable:!0});return b.isDefaultPrevented()?void a.preventDefault():void(this.options.addOnSubmit&&""!==this.$input.suggGetValue()&&(this.$currentItem=null,this.add(this.$input.suggGetValue()),this.options.multiselect&&this.$input.suggSetValue(""),this.closeSuggestBox()))},_beforeFetch:function(a){this._jqXHR=a;var b=this.publish("BeforeFetch",{jqXHR:this._jqXHR,term:this._searchTerm,cancelable:!0});b.isDefaultPrevented()&&this.abortFetch()},_afterFetch:function(a){var b=this.publish("AfterFetch",{jqXHR:this._jqXHR,records:a,term:this._searchTerm,cancelable:!0});this._jqXHR=null,b.isDefaultPrevented()||this.handleSuggestions(b.records)},_closeOnOutsideClick:function(b){var c=a(b.target);c.parents(".sugg-widget")[0]!=this.$widget[0]&&this.closeSuggestBox()},_formatSuggestion:function(a,b){var c,d,e,f,g;return c=this.publish("BeforeFormat",{record:a,substr:b,html:""}),""===c.html&&(d=this.options,e=a[d.valueProperty],f=d.caseSensitive?c.substr:new RegExp("("+c.substr+")","i"),g=d.caseSensitive?c.substr:"$1",c.html=this.listItemTemplate.replace(/\{record\.(.+?)\}/g,function(a,b){var e=c.record[b];return"string"==typeof e||e?(b==d.valueProperty&&d.hightlightSubstring&&(e=e.replace(f,'<strong class="sugg-match">'+g+"</strong>")),e):""})),c=this.publish("AfterFormat",{record:c.record,substr:c.substr,html:c.html}),c.html},_updateInputSize:function(){"auto"==this.options.inputSize&&this.$input.prop("size",this.$input.suggGetValue().length+2)},save:function(){for(var a,b=this.$originalInput.suggGetValue(),c=[],d=0,e=this.tags.length;e>d;d++)c.push(this.tags[d].getValue().replace(/,/g,"\\,"));a=c.join(",");var f=this.publish("BeforeSave",{cancelable:!0,oldValue:b,newValue:a});if(f.isDefaultPrevented())return b;try{this.$originalInput.get(0).value=f.newValue}catch(g){}return this.publish("AfterSave",{oldValue:b,newValue:f.newValue}),f.newValue},_spliceTag:function(a){var b=this.getTagIndex(a);return b>-1?this._spliceTagByIdx(b):void 0},_spliceTagByIdx:function(a){for(var b=this.tags[a],c=[],d=0,e=0,f=this.tags.length;f>e;e++)e===a?(this.tags[e].getHidden().remove(),this.tags[e].getElement().remove()):(this.tags[e].index=d++,c.push(this.tags[e]));return this.tags=c,b},getTagIndex:function(a){var b,c,d=-1;for(b=0,c=this.tags.length;c>b;b++)if(this.tags[b].value==a){d=b;break}return d},_setupPubsub:function(){this.pubsub=a(this),this.on=a.proxy(this.pubsub,"on"),this.off=a.proxy(this.pubsub,"off"),this.one=a.proxy(this.pubsub,"one"),this.bind=a.proxy(this.pubsub,"bind"),this.unbind=a.proxy(this.pubsub,"unbind"),this.trigger=a.proxy(this.pubsub,"trigger"),this.triggerHandler=a.proxy(this.pubsub,"triggerHandler");for(var b in this.options)b.match(/^on[A-Z0-9]/)&&"function"==typeof this.options[b]&&this.on(b.slice(2),this.options[b])},_isCursorAtStart:function(){var a=d(this.$input[0]),b=e(this.$input[0]);return 0===a&&0===b}},a.Suggester.version="1.4.0",a.Suggester.doSubclass={},a.Suggester.instances=[],a.Suggester.addData=function(b){for(var c=0,d=a.Suggester.instances.length;d>c;c++)a.Suggester.instances[c].addData(b);return this},a.Suggester.setData=function(b){for(var c=0,d=a.Suggester.instances.length;d>c;c++)a.Suggester.instances[c].setData(b);return this},a.Suggester.quickBind=document.addEventListener?function(a,b,c){a.addEventListener(b,c,!1)}:function(a,b,c){a.attachEvent("on"+b,function(b){b=b||window.event,b.preventDefault=function(){b.returnValue=!1},c.call(a,b)})},a.Suggester.subclass=function(b,c){var d=function(){this.initialize.apply(this,Array.prototype.slice.call(arguments))};return d.prototype=new a.Suggester(a.Suggester.doSubclass),d.prototype.callParent=function(b){a.Suggester.prototype[b].apply(this,b,Array.prototype.slice.call(arguments,1))},d.prototype.applyParent=function(b,c){a.Suggester.prototype[b].apply(this,b,c)},a.extend(d.prototype,c||{}),f(b,d),d},f("suggester",a.Suggester),a.Suggester.Tag=function(){this.initialize.apply(this,Array.prototype.slice.call(arguments))},a.Suggester.Tag.prototype={initialize:function(b){a.extend(this,b)},getWidget:function(){return this.suggester},remove:function(){return this.suggester.remove(this.value),this},getIndex:function(){return this.index},getValue:function(){return this.value},setValue:function(a){return this.value=a,this.$hidden.suggSetValue(a),this.suggester.options.saveToInput&&this.suggester.save(),this.suggester.publish("Change"),this},getLabel:function(){return this.label},setLabel:function(a){return this.label=a,this.$tag.find(".sugg-label").text(a),this},getHidden:function(){return this.$hidden},getElement:function(){return this.$tag},getRecord:function(){return this.record}}});